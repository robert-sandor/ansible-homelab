---
- name: Deploy adguardhome
  vars:
    adguardhome_deploy_path: "{{ deploy_path }}/adguardhome"
  block:
    - name: Disable systemd-resolved
      ansible.builtin.include_tasks:
        file: ./disable_systemdresolved.yml
        apply:
          become: true

    - name: Flush handlers
      ansible.builtin.meta: flush_handlers

    - name: Deploy container
      ansible.builtin.import_tasks: ./containers.yml

    - name: Configure adguardhome
      ansible.builtin.import_tasks: ./configure.yml

    - name: Configure backup
      ansible.builtin.import_tasks: ./backup_init.yml
